# Gilbert-Elliot模型科学参数设置指南

## 概述

基于NTIA技术备忘录TM-23-565，本文档提供了完整的GE模型科学参数设置方案，用于IPsec性能测试和性能拐点分析。

## 文件说明

### 核心工具
1. **`ge_parameter_calculator.py`** - GE模型参数计算器
2. **`ge_performance_test.sh`** - 完整GE模型性能测试脚本
3. **`quick_ge_test.sh`** - 快速GE模型验证脚本
4. **`set_realistic_network.sh`** - 网络条件设置脚本

### 文档
1. **`ge_model_parameters.md`** - 详细参数设置指南
2. **`BURST_LOSS_USAGE.md`** - 突发丢包使用说明
3. **`GE_MODEL_GUIDE.md`** - 本指南

## 快速开始

### 1. 基础测试 (推荐新手)
```bash
# 5%错误率，突发长度5，坏状态时间40%
sudo ./quick_ge_test.sh -l 0.05 -b 5 -t 0.4

# 10%错误率，突发长度3，双参数模型
sudo ./quick_ge_test.sh -l 0.1 -b 3 -m 2param
```

### 2. 参数计算
```bash
# 计算三参数模型参数
./ge_parameter_calculator.py --model 3param --error-rate 0.05 --burst-length 5 --bad-state-time 0.4 --tc-command --verbose

# 计算双参数模型参数
./ge_parameter_calculator.py --model 2param --error-rate 0.1 --burst-length 3 --tc-command
```

### 3. 完整性能测试
```bash
# 基础性能测试
sudo ./ge_performance_test.sh --mode basic --loss-range "0 5 10 15 20"

# 拐点精确定位
sudo ./ge_performance_test.sh --mode knee --loss-range "8 9 10 11 12" --test-count 100
```

## 科学参数设置方案

### 方案A: 性能拐点发现 (推荐)

#### 错误率范围
```bash
# 低错误率区域 (0-5%) - 基础性能
错误率: 0%, 1%, 2%, 3%, 4%, 5%

# 中等错误率区域 (5-15%) - 拐点区域
错误率: 5%, 7%, 10%, 12%, 15%

# 高错误率区域 (15-25%) - 极限测试
错误率: 15%, 18%, 20%, 22%, 25%
```

#### 突发长度设置
```bash
# 短突发 (轻微拥塞)
L₁ = 2-3

# 中等突发 (一般网络问题)
L₁ = 5-8

# 长突发 (严重网络问题)
L₁ = 10-15
```

#### 坏状态时间比例
```bash
# 轻度网络问题
πB = 0.1-0.3

# 中度网络问题
πB = 0.3-0.6

# 重度网络问题
πB = 0.6-0.8
```

### 方案B: 详细性能分析

#### 精细扫描
```bash
# 0-10% 精细扫描 (每0.5%)
错误率: 0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 5.5, 6.0, 6.5, 7.0, 7.5, 8.0, 8.5, 9.0, 9.5, 10.0

# 10-20% 精细扫描 (每1%)
错误率: 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20
```

## 模型选择指南

### 1. 双参数模型 (2param)
**适用场景**: 简单网络拥塞模拟
**参数**: 错误率(ε) + 预期突发长度(L₁)
**特点**: 简单易用，适合快速测试
**使用**: `--model 2param`

### 2. 三参数模型 (3param) - 推荐
**适用场景**: 真实网络环境模拟
**参数**: 错误率(ε) + 预期突发长度(L₁) + 坏状态时间比例(πB)
**特点**: 平衡了真实性和复杂性
**使用**: `--model 3param`

### 3. 四参数模型 (4param)
**适用场景**: 复杂网络环境模拟
**参数**: 错误率(ε) + 预期突发长度(L₁) + 坏状态时间比例(πB) + 坏状态无错误概率(h)
**特点**: 最真实，但参数设置复杂
**使用**: `--model 4param`

## 测试配置示例

### 配置1: 基础性能测试
```bash
# 测试参数组合
错误率: 0%, 2%, 5%, 8%, 10%, 12%, 15%, 18%, 20%
突发长度: 5 (固定)
坏状态时间: 0.4 (固定)
模型: 3param

# 执行命令
sudo ./ge_performance_test.sh --mode basic --loss-range "0 2 5 8 10 12 15 18 20" --burst-length 5 --bad-state-time 0.4
```

### 配置2: 拐点精确定位
```bash
# 拐点区域精细扫描
错误率: 8%, 8.5%, 9%, 9.5%, 10%, 10.5%, 11%, 11.5%, 12%
突发长度: 5
坏状态时间: 0.4
测试次数: 100次/配置

# 执行命令
sudo ./ge_performance_test.sh --mode knee --loss-range "8 8.5 9 9.5 10 10.5 11 11.5 12" --test-count 100
```

### 配置3: 多参数组合测试
```bash
# 多参数组合
错误率: 5%, 10%, 15%
突发长度: 3, 5, 8
坏状态时间: 0.2, 0.4, 0.6

# 执行命令
sudo ./ge_performance_test.sh --mode full --loss-range "5 10 15"
```

## 数据收集策略

### 主要指标
- **HCT (Handshake Completion Time)**: IKEv2握手完成时间
- **成功率**: 连接建立成功率
- **重传次数**: 数据包重传统计
- **延迟分布**: 握手延迟的分布特征

### 拐点识别指标
- **成功率拐点**: 成功率从>95%急剧下降到<80%的错误率点
- **HCT拐点**: HCT从线性增长变为指数增长的错误率点
- **重传拐点**: 重传次数从<5次急剧增加到>20次的错误率点

### 输出数据格式
```csv
# 原始数据格式
错误率(%),测试序号,结果,HCT(ms),重传次数

# 统计结果格式
错误率(%),突发长度,坏状态时间,模型类型,测试次数,成功率(%),平均HCT(ms),最大HCT(ms),最小HCT(ms),平均重传次数,最大重传次数

# 拐点分析格式
指标类型,拐点错误率(%),拐点值,拐点置信度,线性区域,非线性区域
```

## 预期结果和图表

### 图4: 基础性能曲线
- X轴: 错误率 (0-25%)
- Y轴: HCT (ms)
- 多条曲线: 不同突发长度

### 图5: 成功率曲线
- X轴: 错误率 (0-25%)
- Y轴: 成功率 (%)
- 拐点标记: 性能拐点位置

### 图6: 性能拐点热力图
- X轴: 错误率
- Y轴: 突发长度
- 颜色: 性能指标 (HCT/成功率)
- 等值线: 拐点边界

## 实施建议

### 1. 分阶段测试
1. **阶段1**: 基础双参数模型测试 (0-20%错误率)
2. **阶段2**: 三参数模型精细测试 (拐点区域)
3. **阶段3**: 四参数模型验证测试 (复杂环境)

### 2. 质量控制
- 每个配置至少50次测试
- 拐点区域至少100次测试
- 异常值检测和过滤
- 统计显著性检验

### 3. 结果验证
- 交叉验证不同模型参数
- 对比不同网络接口
- 验证拐点的稳定性
- 分析拐点的物理意义

## 故障排除

### 常见问题
1. **参数无效**: 检查错误率、突发长度、坏状态时间的约束条件
2. **网络设置失败**: 确保有root权限，检查网络接口名称
3. **测试失败**: 检查IPsec服务状态，确保两端网络连通
4. **数据异常**: 检查输入参数范围，验证模型约束

### 调试命令
```bash
# 查看当前网络条件
sudo ./set_realistic_network.sh -s

# 测试网络连通性
ping -c 3 192.168.31.136

# 查看tc规则
tc qdisc show dev ens33

# 验证GE参数
./ge_parameter_calculator.py --model 3param --error-rate 0.05 --burst-length 5 --bad-state-time 0.4 --verbose
```

## 性能拐点分析方法

### 1. 拐点识别算法
```python
def find_performance_knee(data):
    """
    使用Kneedle算法识别性能拐点
    """
    # 计算成功率曲线
    success_rates = []
    loss_rates = []
    
    # 寻找拐点
    knee_point = kneedle_algorithm(loss_rates, success_rates)
    
    return knee_point
```

### 2. 多维度拐点分析
- **单维度**: 基于错误率的拐点
- **双维度**: 错误率+突发长度的拐点曲面
- **三维度**: 错误率+突发长度+坏状态时间的拐点空间

## 脚本使用示例

### 快速验证
```bash
# 验证5%错误率设置
sudo ./quick_ge_test.sh -l 0.05 -b 5 -t 0.4 -n 30

# 验证10%错误率设置
sudo ./quick_ge_test.sh -l 0.1 -b 3 -m 2param -n 30
```

### 完整测试
```bash
# 基础性能测试
sudo ./ge_performance_test.sh --mode basic --loss-range "0 5 10 15 20" --output basic_test

# 拐点精确定位
sudo ./ge_performance_test.sh --mode knee --loss-range "8 9 10 11 12" --test-count 100 --output knee_test

# 完整性能分析
sudo ./ge_performance_test.sh --mode full --output full_test
```

## 总结

这个GE模型参数设置方案基于NTIA的科学研究，提供了：

1. **科学的参数计算方法**: 基于NTIA技术备忘录的数学公式
2. **完整的测试工具链**: 从参数计算到数据收集的完整流程
3. **灵活的测试配置**: 支持多种测试模式和参数组合
4. **自动化的拐点分析**: 自动识别性能拐点位置
5. **详细的结果分析**: 多维度性能指标和统计信息

使用这套工具，您可以：
- 科学地设置GE模型参数
- 系统性地发现IPsec性能拐点
- 生成高质量的测试数据
- 绘制准确的性能曲线图
- 为网络优化提供科学依据

建议从快速验证开始，然后逐步进行完整的性能分析，最终找到准确的性能拐点位置。 