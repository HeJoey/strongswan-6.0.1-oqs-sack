# 突发丢包参数详细解释

## 参数定义

### 基本参数
- **`-l, --loss RATE`**: 丢包率百分比 (0-100)
- **`-b, --burst SIZE`**: 突发大小 (默认: 3)

### 默认配置
```bash
DEFAULT_BURST_SIZE=3  # 默认突发大小
```

## 工作原理

### tc netem 命令格式
```bash
tc qdisc add dev ens33 root netem loss 5% 3
```

### 参数含义
1. **`loss 5%`**: 基础丢包率5%
2. **`3`**: 突发大小，当丢包发生时可能连续丢失1-3个包

## 实际效果

### 设置示例
```bash
# 设置5%丢包率，突发大小3
sudo ./set_network_conditions.sh -l 5 -b 3
```

### 实际丢包行为
- **平均丢包率**: 5%
- **突发丢包**: 当丢包发生时，可能连续丢失1-3个数据包
- **实际波动**: 丢包率在2-8%之间波动

### 为什么是2-8%？
1. **基础丢包**: 5%的包被随机丢弃
2. **突发效应**: 丢包时可能连续丢失多个包
3. **统计特性**: 短时间内的丢包率会有波动

## 不同配置对比

### 配置1: 5%丢包率，突发大小1
```bash
sudo ./set_network_conditions.sh -l 5 -b 1
```
- **效果**: 丢包率相对稳定，接近5%
- **适用**: 模拟稳定的网络丢包

### 配置2: 5%丢包率，突发大小3 (默认)
```bash
sudo ./set_network_conditions.sh -l 5 -b 3
```
- **效果**: 丢包率2-8%波动，有突发丢包
- **适用**: 模拟真实网络环境

### 配置3: 5%丢包率，突发大小5
```bash
sudo ./set_network_conditions.sh -l 5 -b 5
```
- **效果**: 丢包率1-10%波动，突发丢包更严重
- **适用**: 模拟恶劣网络环境

## 对IPsec连接的影响

### 突发丢包的影响
1. **IKE消息丢失**: 可能导致IKE_SA_INIT、IKE_AUTH等消息丢失
2. **重传机制**: 触发strongSwan的重传机制
3. **连接延迟**: 增加握手完成时间(HCT)
4. **连接失败**: 严重时可能导致连接建立失败

### 测试建议
- **理想网络**: 0%丢包率
- **轻度丢包**: 1-5%丢包率，突发大小1-3
- **中度丢包**: 5-15%丢包率，突发大小3-5
- **重度丢包**: 15-25%丢包率，突发大小5-10

## 查看当前设置

### 查看网络条件
```bash
sudo ./set_network_conditions.sh -s
```

### 输出示例
```
当前网络条件设置:
qdisc netem 8001: root refcnt 2 limit 1000 loss 5% 3%

丢包设置: loss 5% 3
```

## 清除设置

### 清除所有网络条件
```bash
sudo ./set_network_conditions.sh -c
```

## 使用建议

1. **测试前**: 确保两端设置相同的网络条件
2. **测试中**: 监控实际丢包情况
3. **测试后**: 及时清除网络条件设置
4. **数据收集**: 记录实际丢包率和突发大小对测试结果的影响 